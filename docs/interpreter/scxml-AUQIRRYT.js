import{a as G}from"./chunk-DCU2SGZ6.js";import{a as Ee}from"./chunk-WFFSAAHR.js";import{a as J}from"./chunk-RSLXVH2O.js";import{a as Q}from"./chunk-QBCC6J4V.js";import"./chunk-SHDKREUK.js";import{b as be}from"./chunk-FW4363Y4.js";var K=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",me=K+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Ne="["+K+"]["+me+"]*",we=new RegExp("^"+Ne+"$");function j(e,t){let n=[],r=t.exec(e);for(;r;){let s=[];s.startIndex=t.lastIndex-r[0].length;let i=r.length;for(let o=0;o<i;o++)s.push(r[o]);n.push(s),r=t.exec(e)}return n}var C=function(e){let t=we.exec(e);return!(t===null||typeof t>"u")};function H(e){return typeof e<"u"}var Te={allowBooleanAttributes:!1,unpairedTags:[]};function re(e,t){t=Object.assign({},Te,t);let n=[],r=!1,s=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=ee(e,i),i.err)return i}else if(e[i]==="<"){let o=i;if(i++,e[i]==="!"){i=te(e,i);continue}else{let u=!1;e[i]==="/"&&(u=!0,i++);let l="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
`&&e[i]!=="\r";i++)l+=e[i];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),i--),!ke(l)){let a;return l.trim().length===0?a="Invalid space after '<'.":a="Tag '"+l+"' is an invalid name.",g("InvalidTag",a,b(e,i))}let f=Oe(e,i);if(f===!1)return g("InvalidAttr","Attributes for '"+l+"' have open quote.",b(e,i));let d=f.value;if(i=f.index,d[d.length-1]==="/"){let a=i-d.length;d=d.substring(0,d.length-1);let h=ne(d,t);if(h===!0)r=!0;else return g(h.err.code,h.err.msg,b(e,a+h.err.line))}else if(u)if(f.tagClosed){if(d.trim().length>0)return g("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",b(e,o));if(n.length===0)return g("InvalidTag","Closing tag '"+l+"' has not been opened.",b(e,o));{let a=n.pop();if(l!==a.tagName){let h=b(e,a.tagStartPos);return g("InvalidTag","Expected closing tag '"+a.tagName+"' (opened in line "+h.line+", col "+h.col+") instead of closing tag '"+l+"'.",b(e,o))}n.length==0&&(s=!0)}}else return g("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",b(e,i));else{let a=ne(d,t);if(a!==!0)return g(a.err.code,a.err.msg,b(e,i-d.length+a.err.line));if(s===!0)return g("InvalidXml","Multiple possible root nodes found.",b(e,i));t.unpairedTags.indexOf(l)!==-1||n.push({tagName:l,tagStartPos:o}),r=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=te(e,i);continue}else if(e[i+1]==="?"){if(i=ee(e,++i),i.err)return i}else break;else if(e[i]==="&"){let a=Ce(e,i);if(a==-1)return g("InvalidChar","char '&' is not expected.",b(e,i));i=a}else if(s===!0&&!D(e[i]))return g("InvalidXml","Extra text at the end",b(e,i));e[i]==="<"&&i--}}else{if(D(e[i]))continue;return g("InvalidChar","char '"+e[i]+"' is not expected.",b(e,i))}if(r){if(n.length==1)return g("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",b(e,n[0].tagStartPos));if(n.length>0)return g("InvalidXml","Invalid '"+JSON.stringify(n.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return g("InvalidXml","Start tag expected.",1);return!0}function D(e){return e===" "||e==="	"||e===`
`||e==="\r"}function ee(e,t){let n=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){let r=e.substr(n,t-n);if(t>5&&r==="xml")return g("InvalidXml","XML declaration allowed only at the start of the document.",b(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function te(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let n=1;for(t+=8;t<e.length;t++)if(e[t]==="<")n++;else if(e[t]===">"&&(n--,n===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}var Ie='"',Ae="'";function Oe(e,t){let n="",r="",s=!1;for(;t<e.length;t++){if(e[t]===Ie||e[t]===Ae)r===""?r=e[t]:r!==e[t]||(r="");else if(e[t]===">"&&r===""){s=!0;break}n+=e[t]}return r!==""?!1:{value:n,index:t,tagClosed:s}}var xe=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function ne(e,t){let n=j(e,xe),r={};for(let s=0;s<n.length;s++){if(n[s][1].length===0)return g("InvalidAttr","Attribute '"+n[s][2]+"' has no space in starting.",_(n[s]));if(n[s][3]!==void 0&&n[s][4]===void 0)return g("InvalidAttr","Attribute '"+n[s][2]+"' is without value.",_(n[s]));if(n[s][3]===void 0&&!t.allowBooleanAttributes)return g("InvalidAttr","boolean attribute '"+n[s][2]+"' is not allowed.",_(n[s]));let i=n[s][2];if(!Se(i))return g("InvalidAttr","Attribute '"+i+"' is an invalid name.",_(n[s]));if(!r.hasOwnProperty(i))r[i]=1;else return g("InvalidAttr","Attribute '"+i+"' is repeated.",_(n[s]))}return!0}function ve(e,t){let n=/\d/;for(e[t]==="x"&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(n))break}return-1}function Ce(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,ve(e,t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(e[t]===";")break;return-1}return t}function g(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function Se(e){return C(e)}function ke(e){return C(e)}function b(e,t){let n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function _(e){return e.startIndex+e[1].length}var Pe={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e},captureMetaData:!1};function se(e){return typeof e=="boolean"?{enabled:e,maxEntitySize:1e4,maxExpansionDepth:10,maxTotalExpansions:1e3,maxExpandedLength:1e5,allowedTags:null,tagFilter:null}:typeof e=="object"&&e!==null?{enabled:e.enabled!==!1,maxEntitySize:e.maxEntitySize??1e4,maxExpansionDepth:e.maxExpansionDepth??10,maxTotalExpansions:e.maxTotalExpansions??1e3,maxExpandedLength:e.maxExpandedLength??1e5,allowedTags:e.allowedTags??null,tagFilter:e.tagFilter??null}:se(!0)}var ie=function(e){let t=Object.assign({},Pe,e);return t.processEntities=se(t.processEntities),t};var R;typeof Symbol!="function"?R="@@xmlMetadata":R=Symbol("XML Node Metadata");var m=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,n){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:n})}addChild(t,n){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child}),n!==void 0&&(this.child[this.child.length-1][R]={startIndex:n})}static getMetaDataSymbol(){return R}};var L=class{constructor(t){this.suppressValidationErr=!t,this.options=t}readDocType(t,n){let r={};if(t[n+3]==="O"&&t[n+4]==="C"&&t[n+5]==="T"&&t[n+6]==="Y"&&t[n+7]==="P"&&t[n+8]==="E"){n=n+9;let s=1,i=!1,o=!1,u="";for(;n<t.length;n++)if(t[n]==="<"&&!o){if(i&&A(t,"!ENTITY",n)){n+=7;let l,f;if([l,f,n]=this.readEntityExp(t,n+1,this.suppressValidationErr),f.indexOf("&")===-1){let d=l.replace(/[.\-+*:]/g,"\\.");r[l]={regx:RegExp(`&${d};`,"g"),val:f}}}else if(i&&A(t,"!ELEMENT",n)){n+=8;let{index:l}=this.readElementExp(t,n+1);n=l}else if(i&&A(t,"!ATTLIST",n))n+=8;else if(i&&A(t,"!NOTATION",n)){n+=9;let{index:l}=this.readNotationExp(t,n+1,this.suppressValidationErr);n=l}else if(A(t,"!--",n))o=!0;else throw new Error("Invalid DOCTYPE");s++,u=""}else if(t[n]===">"){if(o?t[n-1]==="-"&&t[n-2]==="-"&&(o=!1,s--):s--,s===0)break}else t[n]==="["?i=!0:u+=t[n];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:n}}readEntityExp(t,n){n=E(t,n);let r="";for(;n<t.length&&!/\s/.test(t[n])&&t[n]!=='"'&&t[n]!=="'";)r+=t[n],n++;if(V(r),n=E(t,n),!this.suppressValidationErr){if(t.substring(n,n+6).toUpperCase()==="SYSTEM")throw new Error("External entities are not supported");if(t[n]==="%")throw new Error("Parameter entities are not supported")}let s="";if([n,s]=this.readIdentifierVal(t,n,"entity"),this.options.enabled!==!1&&this.options.maxEntitySize&&s.length>this.options.maxEntitySize)throw new Error(`Entity "${r}" size (${s.length}) exceeds maximum allowed size (${this.options.maxEntitySize})`);return n--,[r,s,n]}readNotationExp(t,n){n=E(t,n);let r="";for(;n<t.length&&!/\s/.test(t[n]);)r+=t[n],n++;!this.suppressValidationErr&&V(r),n=E(t,n);let s=t.substring(n,n+6).toUpperCase();if(!this.suppressValidationErr&&s!=="SYSTEM"&&s!=="PUBLIC")throw new Error(`Expected SYSTEM or PUBLIC, found "${s}"`);n+=s.length,n=E(t,n);let i=null,o=null;if(s==="PUBLIC")[n,i]=this.readIdentifierVal(t,n,"publicIdentifier"),n=E(t,n),(t[n]==='"'||t[n]==="'")&&([n,o]=this.readIdentifierVal(t,n,"systemIdentifier"));else if(s==="SYSTEM"&&([n,o]=this.readIdentifierVal(t,n,"systemIdentifier"),!this.suppressValidationErr&&!o))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:r,publicIdentifier:i,systemIdentifier:o,index:--n}}readIdentifierVal(t,n,r){let s="",i=t[n];if(i!=='"'&&i!=="'")throw new Error(`Expected quoted string, found "${i}"`);for(n++;n<t.length&&t[n]!==i;)s+=t[n],n++;if(t[n]!==i)throw new Error(`Unterminated ${r} value`);return n++,[n,s]}readElementExp(t,n){n=E(t,n);let r="";for(;n<t.length&&!/\s/.test(t[n]);)r+=t[n],n++;if(!this.suppressValidationErr&&!C(r))throw new Error(`Invalid element name: "${r}"`);n=E(t,n);let s="";if(t[n]==="E"&&A(t,"MPTY",n))n+=4;else if(t[n]==="A"&&A(t,"NY",n))n+=2;else if(t[n]==="("){for(n++;n<t.length&&t[n]!==")";)s+=t[n],n++;if(t[n]!==")")throw new Error("Unterminated content model")}else if(!this.suppressValidationErr)throw new Error(`Invalid Element Expression, found "${t[n]}"`);return{elementName:r,contentModel:s.trim(),index:n}}readAttlistExp(t,n){n=E(t,n);let r="";for(;n<t.length&&!/\s/.test(t[n]);)r+=t[n],n++;V(r),n=E(t,n);let s="";for(;n<t.length&&!/\s/.test(t[n]);)s+=t[n],n++;if(!V(s))throw new Error(`Invalid attribute name: "${s}"`);n=E(t,n);let i="";if(t.substring(n,n+8).toUpperCase()==="NOTATION"){if(i="NOTATION",n+=8,n=E(t,n),t[n]!=="(")throw new Error(`Expected '(', found "${t[n]}"`);n++;let u=[];for(;n<t.length&&t[n]!==")";){let l="";for(;n<t.length&&t[n]!=="|"&&t[n]!==")";)l+=t[n],n++;if(l=l.trim(),!V(l))throw new Error(`Invalid notation name: "${l}"`);u.push(l),t[n]==="|"&&(n++,n=E(t,n))}if(t[n]!==")")throw new Error("Unterminated list of notations");n++,i+=" ("+u.join("|")+")"}else{for(;n<t.length&&!/\s/.test(t[n]);)i+=t[n],n++;let u=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!u.includes(i.toUpperCase()))throw new Error(`Invalid attribute type: "${i}"`)}n=E(t,n);let o="";return t.substring(n,n+8).toUpperCase()==="#REQUIRED"?(o="#REQUIRED",n+=8):t.substring(n,n+7).toUpperCase()==="#IMPLIED"?(o="#IMPLIED",n+=7):[n,o]=this.readIdentifierVal(t,n,"ATTLIST"),{elementName:r,attributeName:s,attributeType:i,defaultValue:o,index:n}}},E=(e,t)=>{for(;t<e.length&&/\s/.test(e[t]);)t++;return t};function A(e,t,n){for(let r=0;r<t.length;r++)if(t[r]!==e[n+r+1])return!1;return!0}function V(e){if(C(e))return e;throw new Error(`Invalid entity name ${e}`)}var _e=/^[-+]?0x[a-fA-F0-9]+$/,Ve=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Le={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function X(e,t={}){if(t=Object.assign({},Le,t),!e||typeof e!="string")return e;let n=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(n))return e;if(e==="0")return 0;if(t.hex&&_e.test(n))return Re(n,16);if(n.includes("e")||n.includes("E"))return Me(e,n,t);{let r=Ve.exec(n);if(r){let s=r[1]||"",i=r[2],o=je(r[3]),u=s?e[i.length+1]===".":e[i.length]===".";if(!t.leadingZeros&&(i.length>1||i.length===1&&!u))return e;{let l=Number(n),f=String(l);if(l===0)return l;if(f.search(/[eE]/)!==-1)return t.eNotation?l:e;if(n.indexOf(".")!==-1)return f==="0"||f===o||f===`${s}${o}`?l:e;let d=i?o:n;return i?d===f||s+d===f?l:e:d===f||d===s+f?l:e}}else return e}}var Fe=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function Me(e,t,n){if(!n.eNotation)return e;let r=t.match(Fe);if(r){let s=r[1]||"",i=r[3].indexOf("e")===-1?"E":"e",o=r[2],u=s?e[o.length+1]===i:e[o.length]===i;return o.length>1&&u?e:o.length===1&&(r[3].startsWith(`.${i}`)||r[3][0]===i)?Number(t):n.leadingZeros&&!u?(t=(r[1]||"")+r[3],Number(t)):e}else return e}function je(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substring(0,e.length-1))),e}function Re(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}function B(e){return typeof e=="function"?e:Array.isArray(e)?t=>{for(let n of e)if(typeof n=="string"&&t===n||n instanceof RegExp&&n.test(t))return!0}:()=>!1}var F=class{constructor(t){if(this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(n,r)=>oe(r,10,"&#")},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(n,r)=>oe(r,16,"&#x")}},this.addExternalEntities=$e,this.parseXml=Ye,this.parseTextData=Xe,this.resolveNameSpace=Be,this.buildAttributesMap=Ue,this.isItStopNode=Qe,this.replaceEntitiesValue=We,this.readStopNodeData=Je,this.saveTextToParentTag=qe,this.addChild=Ze,this.ignoreAttributesFn=B(this.options.ignoreAttributes),this.entityExpansionCount=0,this.currentExpandedLength=0,this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let n=0;n<this.options.stopNodes.length;n++){let r=this.options.stopNodes[n];typeof r=="string"&&(r.startsWith("*.")?this.stopNodesWildcard.add(r.substring(2)):this.stopNodesExact.add(r))}}}};function $e(e){let t=Object.keys(e);for(let n=0;n<t.length;n++){let r=t[n],s=r.replace(/[.\-+*:]/g,"\\.");this.lastEntities[r]={regex:new RegExp("&"+s+";","g"),val:e[r]}}}function Xe(e,t,n,r,s,i,o){if(e!==void 0&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e,t,n));let u=this.options.tagValueProcessor(t,e,n,s,i);return u==null?e:typeof u!=typeof e||u!==e?u:this.options.trimValues?U(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?U(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Be(e){if(this.options.removeNSPrefix){let t=e.split(":"),n=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=n+t[1])}return e}var ze=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Ue(e,t,n){if(this.options.ignoreAttributes!==!0&&typeof e=="string"){let r=j(e,ze),s=r.length,i={};for(let o=0;o<s;o++){let u=this.resolveNameSpace(r[o][1]);if(this.ignoreAttributesFn(u,t))continue;let l=r[o][4],f=this.options.attributeNamePrefix+u;if(u.length)if(this.options.transformAttributeName&&(f=this.options.transformAttributeName(f)),f==="__proto__"&&(f="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l,n,t);let d=this.options.attributeValueProcessor(u,l,t);d==null?i[f]=l:typeof d!=typeof l||d!==l?i[f]=d:i[f]=U(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[f]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){let o={};return o[this.options.attributesGroupName]=i,o}return i}}var Ye=function(e){e=e.replace(/\r\n?/g,`
`);let t=new m("!xml"),n=t,r="",s="";this.entityExpansionCount=0,this.currentExpandedLength=0;let i=new L(this.options.processEntities);for(let o=0;o<e.length;o++)if(e[o]==="<")if(e[o+1]==="/"){let l=O(e,">",o,"Closing Tag is not closed."),f=e.substring(o+2,l).trim();if(this.options.removeNSPrefix){let h=f.indexOf(":");h!==-1&&(f=f.substr(h+1))}this.options.transformTagName&&(f=this.options.transformTagName(f)),n&&(r=this.saveTextToParentTag(r,n,s));let d=s.substring(s.lastIndexOf(".")+1);if(f&&this.options.unpairedTags.indexOf(f)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${f}>`);let a=0;d&&this.options.unpairedTags.indexOf(d)!==-1?(a=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):a=s.lastIndexOf("."),s=s.substring(0,a),n=this.tagsNodeStack.pop(),r="",o=l}else if(e[o+1]==="?"){let l=z(e,o,!1,"?>");if(!l)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,s),!(this.options.ignoreDeclaration&&l.tagName==="?xml"||this.options.ignorePiTags)){let f=new m(l.tagName);f.add(this.options.textNodeName,""),l.tagName!==l.tagExp&&l.attrExpPresent&&(f[":@"]=this.buildAttributesMap(l.tagExp,s,l.tagName)),this.addChild(n,f,s,o)}o=l.closeIndex+1}else if(e.substr(o+1,3)==="!--"){let l=O(e,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){let f=e.substring(o+4,l-2);r=this.saveTextToParentTag(r,n,s),n.add(this.options.commentPropName,[{[this.options.textNodeName]:f}])}o=l}else if(e.substr(o+1,2)==="!D"){let l=i.readDocType(e,o);this.docTypeEntities=l.entities,o=l.i}else if(e.substr(o+1,2)==="!["){let l=O(e,"]]>",o,"CDATA is not closed.")-2,f=e.substring(o+9,l);r=this.saveTextToParentTag(r,n,s);let d=this.parseTextData(f,n.tagname,s,!0,!1,!0,!0);d==null&&(d=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:f}]):n.add(this.options.textNodeName,d),o=l+2}else{let l=z(e,o,this.options.removeNSPrefix),f=l.tagName,d=l.rawTagName,a=l.tagExp,h=l.attrExpPresent,c=l.closeIndex;if(this.options.transformTagName){let p=this.options.transformTagName(f);a===f&&(a=p),f=p}n&&r&&n.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,n,s,!1));let P=n;P&&this.options.unpairedTags.indexOf(P.tagname)!==-1&&(n=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),f!==t.tagname&&(s+=s?"."+f:f);let v=o;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,s,f)){let p="";if(a.length>0&&a.lastIndexOf("/")===a.length-1)f[f.length-1]==="/"?(f=f.substr(0,f.length-1),s=s.substr(0,s.length-1),a=f):a=a.substr(0,a.length-1),o=l.closeIndex;else if(this.options.unpairedTags.indexOf(f)!==-1)o=l.closeIndex;else{let I=this.readStopNodeData(e,d,c+1);if(!I)throw new Error(`Unexpected end of ${d}`);o=I.i,p=I.tagContent}let y=new m(f);f!==a&&h&&(y[":@"]=this.buildAttributesMap(a,s,f)),p&&(p=this.parseTextData(p,f,s,!0,h,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),y.add(this.options.textNodeName,p),this.addChild(n,y,s,v)}else{if(a.length>0&&a.lastIndexOf("/")===a.length-1){if(f[f.length-1]==="/"?(f=f.substr(0,f.length-1),s=s.substr(0,s.length-1),a=f):a=a.substr(0,a.length-1),this.options.transformTagName){let y=this.options.transformTagName(f);a===f&&(a=y),f=y}let p=new m(f);f!==a&&h&&(p[":@"]=this.buildAttributesMap(a,s,f)),this.addChild(n,p,s,v),s=s.substr(0,s.lastIndexOf("."))}else{let p=new m(f);this.tagsNodeStack.push(n),f!==a&&h&&(p[":@"]=this.buildAttributesMap(a,s,f)),this.addChild(n,p,s,v),n=p}r="",o=c}}else r+=e[o];return t.child};function Ze(e,t,n,r){this.options.captureMetaData||(r=void 0);let s=this.options.updateTag(t.tagname,n,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),e.addChild(t,r))}var We=function(e,t,n){if(e.indexOf("&")===-1)return e;let r=this.options.processEntities;if(!r.enabled||r.allowedTags&&!r.allowedTags.includes(t)||r.tagFilter&&!r.tagFilter(t,n))return e;for(let s in this.docTypeEntities){let i=this.docTypeEntities[s],o=e.match(i.regx);if(o){if(this.entityExpansionCount+=o.length,r.maxTotalExpansions&&this.entityExpansionCount>r.maxTotalExpansions)throw new Error(`Entity expansion limit exceeded: ${this.entityExpansionCount} > ${r.maxTotalExpansions}`);let u=e.length;if(e=e.replace(i.regx,i.val),r.maxExpandedLength&&(this.currentExpandedLength+=e.length-u,this.currentExpandedLength>r.maxExpandedLength))throw new Error(`Total expanded content size exceeded: ${this.currentExpandedLength} > ${r.maxExpandedLength}`)}}if(e.indexOf("&")===-1)return e;for(let s in this.lastEntities){let i=this.lastEntities[s];e=e.replace(i.regex,i.val)}if(e.indexOf("&")===-1)return e;if(this.options.htmlEntities)for(let s in this.htmlEntities){let i=this.htmlEntities[s];e=e.replace(i.regex,i.val)}return e=e.replace(this.ampEntity.regex,this.ampEntity.val),e};function qe(e,t,n,r){return e&&(r===void 0&&(r=t.child.length===0),e=this.parseTextData(e,t.tagname,n,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,r),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function Qe(e,t,n,r){return!!(t&&t.has(r)||e&&e.has(n))}function Ge(e,t,n=">"){let r,s="";for(let i=t;i<e.length;i++){let o=e[i];if(r)o===r&&(r="");else if(o==='"'||o==="'")r=o;else if(o===n[0])if(n[1]){if(e[i+1]===n[1])return{data:s,index:i}}else return{data:s,index:i};else o==="	"&&(o=" ");s+=o}}function O(e,t,n,r){let s=e.indexOf(t,n);if(s===-1)throw new Error(r);return s+t.length-1}function z(e,t,n,r=">"){let s=Ge(e,t+1,r);if(!s)return;let i=s.data,o=s.index,u=i.search(/\s/),l=i,f=!0;u!==-1&&(l=i.substring(0,u),i=i.substring(u+1).trimStart());let d=l;if(n){let a=l.indexOf(":");a!==-1&&(l=l.substr(a+1),f=l!==s.data.substr(a+1))}return{tagName:l,tagExp:i,closeIndex:o,attrExpPresent:f,rawTagName:d}}function Je(e,t,n){let r=n,s=1;for(;n<e.length;n++)if(e[n]==="<")if(e[n+1]==="/"){let i=O(e,">",n,`${t} is not closed`);if(e.substring(n+2,i).trim()===t&&(s--,s===0))return{tagContent:e.substring(r,n),i};n=i}else if(e[n+1]==="?")n=O(e,"?>",n+1,"StopNode is not closed.");else if(e.substr(n+1,3)==="!--")n=O(e,"-->",n+3,"StopNode is not closed.");else if(e.substr(n+1,2)==="![")n=O(e,"]]>",n,"StopNode is not closed.")-2;else{let i=z(e,n,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&s++,n=i.closeIndex)}}function U(e,t,n){if(t&&typeof e=="string"){let r=e.trim();return r==="true"?!0:r==="false"?!1:X(e,n)}else return H(e)?e:""}function oe(e,t,n){let r=Number.parseInt(e,t);return r>=0&&r<=1114111?String.fromCodePoint(r):n+e+";"}var Y=m.getMetaDataSymbol();function Z(e,t){return le(e,t)}function le(e,t,n){let r,s={};for(let i=0;i<e.length;i++){let o=e[i],u=Ke(o),l="";if(n===void 0?l=u:l=n+"."+u,u===t.textNodeName)r===void 0?r=o[u]:r+=""+o[u];else{if(u===void 0)continue;if(o[u]){let f=le(o[u],t,l),d=De(f,t);o[Y]!==void 0&&(f[Y]=o[Y]),o[":@"]?He(f,o[":@"],l,t):Object.keys(f).length===1&&f[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?f=f[t.textNodeName]:Object.keys(f).length===0&&(t.alwaysCreateTextNode?f[t.textNodeName]="":f=""),s[u]!==void 0&&s.hasOwnProperty(u)?(Array.isArray(s[u])||(s[u]=[s[u]]),s[u].push(f)):t.isArray(u,l,d)?s[u]=[f]:s[u]=f}}}return typeof r=="string"?r.length>0&&(s[t.textNodeName]=r):r!==void 0&&(s[t.textNodeName]=r),s}function Ke(e){let t=Object.keys(e);for(let n=0;n<t.length;n++){let r=t[n];if(r!==":@")return r}}function He(e,t,n,r){if(t){let s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){let u=s[o];r.isArray(u,n+"."+u,!0,!0)?e[u]=[t[u]]:e[u]=t[u]}}}function De(e,t){let{textNodeName:n}=t,r=Object.keys(e).length;return!!(r===0||r===1&&(e[n]||typeof e[n]=="boolean"||e[n]===0))}var S=class{constructor(t){this.externalEntities={},this.options=ie(t)}parse(t,n){if(typeof t!="string"&&t.toString)t=t.toString();else if(typeof t!="string")throw new Error("XML data is accepted in String or Bytes[] form.");if(n){n===!0&&(n={});let i=re(t,n);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}let r=new F(this.options);r.addExternalEntities(this.externalEntities);let s=r.parseXml(t);return this.options.preserveOrder||s===void 0?s:Z(s,this.options)}addEntity(t,n){if(n.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(n==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=n}static getMetaDataSymbol(){return m.getMetaDataSymbol()}};var x=be(Ee(),1);var k=e=>Object.prototype.toString.call(e),ue=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),et=e=>k(e)==="[object Date]",tt=e=>k(e)==="[object RegExp]",nt=e=>k(e)==="[object Error]",rt=e=>k(e)==="[object Boolean]",st=e=>k(e)==="[object Number]",it=e=>k(e)==="[object String]",ae=Array.isArray,ot=Object.getOwnPropertyDescriptor,lt=Object.prototype.propertyIsEnumerable,ft=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty;function W(e){let t=Object.keys(e),n=ft(e);for(let r=0;r<n.length;r++)lt.call(e,n[r])&&t.push(n[r]);return t}function ut(e,t){return!ot(e,t)?.writable}function ce(e,t){if(typeof e=="object"&&e!==null){let n;if(ae(e))n=[];else if(et(e))n=new Date(e.getTime?e.getTime():e);else if(tt(e))n=new RegExp(e);else if(nt(e))n={message:e.message};else if(rt(e)||st(e)||it(e))n=Object(e);else{if(ue(e))return e.slice();n=Object.create(Object.getPrototypeOf(e))}let r=t.includeSymbols?W:Object.keys;for(let s of r(e))n[s]=e[s];return n}return e}var de={includeSymbols:!1,immutable:!1};function fe(e,t,n=de){let r=[],s=[],i=!0,o=n.includeSymbols?W:Object.keys,u=!!n.immutable;return(function l(f){let d=u?ce(f,n):f,a={},h=!0,c={node:d,node_:f,path:[].concat(r),parent:s[s.length-1],parents:s,key:r[r.length-1],isRoot:r.length===0,level:r.length,circular:void 0,isLeaf:!1,notLeaf:!0,notRoot:!0,isFirst:!1,isLast:!1,update:function(p,y=!1){c.isRoot||(c.parent.node[c.key]=p),c.node=p,y&&(h=!1)},delete:function(p){delete c.parent.node[c.key],p&&(h=!1)},remove:function(p){ae(c.parent.node)?c.parent.node.splice(c.key,1):delete c.parent.node[c.key],p&&(h=!1)},keys:null,before:function(p){a.before=p},after:function(p){a.after=p},pre:function(p){a.pre=p},post:function(p){a.post=p},stop:function(){i=!1},block:function(){h=!1}};if(!i)return c;function P(){if(typeof c.node=="object"&&c.node!==null){(!c.keys||c.node_!==c.node)&&(c.keys=o(c.node)),c.isLeaf=c.keys.length===0;for(let p=0;p<s.length;p++)if(s[p].node_===f){c.circular=s[p];break}}else c.isLeaf=!0,c.keys=null;c.notLeaf=!c.isLeaf,c.notRoot=!c.isRoot}P();let v=t.call(c,c.node);if(v!==void 0&&c.update&&c.update(v),a.before&&a.before.call(c,c.node),!h)return c;if(typeof c.node=="object"&&c.node!==null&&!c.circular){s.push(c),P();for(let[p,y]of Object.entries(c.keys??[])){r.push(y),a.pre&&a.pre.call(c,c.node[y],y);let I=l(c.node[y]);u&&$.call(c.node,y)&&!ut(c.node,y)&&(c.node[y]=I.node),I.isLast=c.keys?.length?+p===c.keys.length-1:!1,I.isFirst=+p==0,a.post&&a.post.call(c,I),r.pop()}s.pop()}return a.after&&a.after.call(c,c.node),c})(e).node}var N=class{#e;#t;constructor(e,t=de){this.#e=e,this.#t=t}get(e){let t=this.#e;for(let n=0;t&&n<e.length;n++){let r=e[n];if(!$.call(t,r)||!this.#t.includeSymbols&&typeof r=="symbol")return;t=t[r]}return t}has(e){let t=this.#e;for(let n=0;t&&n<e.length;n++){let r=e[n];if(!$.call(t,r)||!this.#t.includeSymbols&&typeof r=="symbol")return!1;t=t[r]}return!0}set(e,t){let n=this.#e,r=0;for(r=0;r<e.length-1;r++){let s=e[r];$.call(n,s)||(n[s]={}),n=n[s]}return n[e[r]]=t,t}map(e){return fe(this.#e,e,{immutable:!0,includeSymbols:!!this.#t.includeSymbols})}forEach(e){return this.#e=fe(this.#e,e,this.#t),this.#e}reduce(e,t){let n=arguments.length===1,r=n?this.#e:t;return this.forEach(function(s){(!this.isRoot||!n)&&(r=e.call(this,r,s))}),r}paths(){let e=[];return this.forEach(function(){e.push(this.path)}),e}nodes(){let e=[];return this.forEach(function(){e.push(this.node)}),e}clone(){let e=[],t=[],n=this.#t;return ue(this.#e)?this.#e.slice():(function r(s){for(let i=0;i<e.length;i++)if(e[i]===s)return t[i];if(typeof s=="object"&&s!==null){let i=ce(s,n);e.push(s),t.push(i);let o=n.includeSymbols?W:Object.keys;for(let u of o(s))i[u]=r(s[u]);return e.pop(),t.pop(),i}return s})(this.#e)}},w=(e,t)=>new N(e,t);w.get=(e,t,n)=>new N(e,n).get(t);w.set=(e,t,n,r)=>new N(e,r).set(t,n);w.has=(e,t,n)=>new N(e,n).has(t);w.map=(e,t,n)=>new N(e,n).map(t);w.forEach=(e,t,n)=>new N(e,n).forEach(t);w.reduce=(e,t,n,r)=>new N(e,r).reduce(t,n);w.paths=(e,t)=>new N(e,t).paths();w.nodes=(e,t)=>new N(e,t).nodes();w.clone=(e,t)=>new N(e,t).clone();var pe=w;function T(e){return Array.isArray(e)?e:[e]}function at(e,t){let n={id:t?`${t}.initial`:"initial"};return e.transition&&Object.assign(n,{transition:[e.transition]}),n}function ct(e){return{id:"initial",transition:[{target:e}]}}function dt(e){let t=[];return e.initial&&(typeof e.initial=="string"?t.push(ct(e.initial)):t.push(at(e.initial,e.id))),t}function he(e){return{...e,initial:dt(e),state:T(e?.state??[]),parallel:T(e?.parallel??[]),history:T(e?.history??[]),final:T(e?.final??[])}}function ge(e,t){return T(e[t]).map(n=>({type:t==="onexit"?"exit":"entry",body:x.default.decode(n).trim()}))}function pt(e){return T(e).map(t=>({type:"activity",body:x.default.decode(t.id||"").trim()||x.default.decode(t||"").trim()}))}function ht(e){let t=[];return e.onentry&&(t=t.concat(ge(e,"onentry"))),e.invoke&&(t=t.concat(pt(e.invoke))),e.onexit&&(t=t.concat(ge(e,"onexit"))),t}function gt(e,t){return e==="history"&&t.type==="deep"?"deephistory":e}function M(e){return t=>{let n={name:t.id,type:gt(e,t)};return G(t.id)!==n.type&&(n.typeExplicitlySet=!0),(t.onentry||t.onexit||t.invoke)&&(n.actions=ht(t)),Object.keys(t).some(r=>["initial","state","history","parallel","final"].includes(r))&&(n.statemachine=ye(t)),n}}function yt(e){let t={};return e.event&&(t.event=e.event.split(/\s+/).join(`
`)),e.cond&&(t.cond=e.cond),e["#text"]&&(t.action=x.default.decode(e["#text"]).trim()),e.type&&(t.type=e.type),t}function bt(e){let t={};typeof e=="string"?t.action=x.default.decode(e).trim():Object.assign(t,yt(e));let n=J(t.event,t.cond,t.action);return n&&(t.label=n),t}function Et(e,t){return(n,r)=>{let s=(r?.target??e.id).split(/\s+/),i=bt(r);return n.concat(s.map(o=>({id:t.next(),from:e.id,to:o,...i})))}}function q(e,t){return e.filter(n=>Object.hasOwn(n,"transition")).reduce((n,r)=>{let s=T(r.transition);return n.concat(s.reduce(Et(r,t),[]))},[])}function ye(e){let t=he(e),n={states:t.initial.map(M("initial")).concat(t.state.map(M("regular"))).concat(t.parallel.map(M("parallel"))).concat(t.history.map(M("history"))).concat(t.final.map(M("final")))},r=new Q,s=q(t.initial,r).concat(q(t.state,r)).concat(q(t.parallel,r));return s.length>0&&(n.transitions=s),n}function mt(e,t){return pe(e).map(function(){if(this.key?.startsWith(t)){let r=this.key.slice(t.length);this.parent.keys.includes(r)?this.remove():(this.parent.node[r]=this.node,this.remove())}})}function rn(e){let t=e.trim(),n="@_",r={},s=new S({attributeNamePrefix:n,ignoreAttributes:!1,parseTagValue:!0,processEntities:!1,tagValueProcessor:(i,o)=>x.default.decode(o),stopNodes:["*.onentry","*.onexit","*.transition"]});try{r=mt(s.parse(t,!0),n)}catch{throw new Error(`That doesn't look like valid xml ...
`)}return ye(r?.scxml??{xmlns:"http://www.w3.org/2005/07/scxml",version:"1.0"})}export{rn as parse};
//# sourceMappingURL=scxml-AUQIRRYT.js.map
