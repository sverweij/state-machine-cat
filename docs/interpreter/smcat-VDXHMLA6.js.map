{
  "version": 3,
  "sources": ["../../src/render/smcat.mts"],
  "sourcesContent": ["import type {\n  IActionType,\n  IState,\n  IStateMachine,\n  IRenderOptions,\n  ITransition,\n} from \"../../types/state-machine-cat.mjs\";\n\nconst NAME_QUOTABLE = /[;,{[ ]/;\nconst ACTIONS_QUOTABLE = /[;,{}]/;\nconst LABEL_QUOTABLE = /[;{]/;\n\nconst RENDERABLE_STATE_ATTRIBUTES = [\n  \"label\",\n  \"type\",\n  \"color\",\n  \"active\",\n  \"class\",\n];\n\nconst RENDERABLE_TRANSITION_ATTRIBUTES = [\"type\", \"color\", \"class\"];\n\nfunction quoteIfNecessary(pRegExp: RegExp, pString: string): string {\n  return pRegExp.test(pString) ? `\"${pString}\"` : pString;\n}\n\nfunction stateHasExtendedAttributes(pState: IState): boolean {\n  return (\n    Object.hasOwn(pState, \"label\") ||\n    Object.hasOwn(pState, \"typeExplicitlySet\") ||\n    Object.hasOwn(pState, \"color\") ||\n    Object.hasOwn(pState, \"active\") ||\n    Object.hasOwn(pState, \"class\")\n  );\n}\n\nfunction note(pNote: string[], pIndent: string = \"\"): string {\n  return pNote.map((pNoteLine) => `${pIndent}# ${pNoteLine}`).join(\"\\n\");\n}\n\nfunction extendedAttribute(pKey: string, pValue: string): string {\n  if (pKey === \"type\") {\n    // looks a lot like the default return, but this guy's without quotes\n    return `${pKey}=${pValue}`;\n  }\n  if (pKey === \"active\") {\n    return pValue ? pKey : \"\";\n  }\n  return `${pKey}=\"${pValue}\"`;\n}\n\nfunction extendedStateAttributes(pState: IState): string {\n  return Object.entries(pState)\n    .filter(([pKey]) => RENDERABLE_STATE_ATTRIBUTES.includes(pKey))\n    .filter(([pKey]) => pKey !== \"type\" || pState.typeExplicitlySet)\n    .map(([pKey, pValue]) => extendedAttribute(pKey, pValue))\n    .join(\" \");\n}\n\nfunction actions(pActions: IActionType[]): string {\n  return pActions\n    .map(\n      (pAction) =>\n        `${pAction.type === \"activity\" ? \"\" : `${pAction.type}/ `}${pAction.body}`,\n    )\n    .map((pAction) => quoteIfNecessary(ACTIONS_QUOTABLE, pAction))\n    .join(\"\\n    \");\n}\n\nfunction state(pState: IState, pIndent: string = \"\"): string {\n  let lReturnValue = pIndent + quoteIfNecessary(NAME_QUOTABLE, pState.name);\n  if (pState.note) {\n    lReturnValue = `${note(pState.note, pIndent)}\\n${lReturnValue}`;\n  }\n  if (stateHasExtendedAttributes(pState)) {\n    lReturnValue += ` [${extendedStateAttributes(pState)}]`;\n  }\n  if (pState.actions) {\n    lReturnValue += `: ${actions(pState.actions)}`;\n  }\n  if (pState.statemachine) {\n    lReturnValue += \" {\\n\";\n    // eslint-disable-next-line no-use-before-define\n    lReturnValue += renderSmcat(pState.statemachine, null, `${pIndent}    `);\n    lReturnValue += `${pIndent}}`;\n  }\n\n  return lReturnValue;\n}\n\nfunction states(pStates: IState[], pIndent: string = \"\"): string {\n  return pStates\n    .map((pState) => state(pState, pIndent))\n    .join(\",\\n\")\n    .concat(pStates.length > 0 ? \";\\n\\n\" : \"\");\n}\n\nfunction transitionHasExtendedAttributes(pTransition: ITransition): boolean {\n  return Object.entries(pTransition).some(([pKey]) =>\n    RENDERABLE_TRANSITION_ATTRIBUTES.includes(pKey),\n  );\n}\n\nfunction extendedTransitionAttributes(pTransition: ITransition): string {\n  return (\n    Object.entries(pTransition)\n      .filter(([pKey]) => RENDERABLE_TRANSITION_ATTRIBUTES.includes(pKey))\n      // lazily re-using the extendedStateAttribute function, even though it does\n      // a little more than necessary\n      .map(([pKey, pValue]) => extendedAttribute(pKey, pValue))\n      .join(\" \")\n  );\n}\n\nfunction transition(pTransition: ITransition, pIndent: string = \"\"): string {\n  let lReturnValue = `${pIndent}${quoteIfNecessary(NAME_QUOTABLE, pTransition.from)} => ${quoteIfNecessary(\n    NAME_QUOTABLE,\n    pTransition.to,\n  )}`;\n  if (pTransition.note) {\n    lReturnValue = `${note(pTransition.note, pIndent)}\\n${lReturnValue}`;\n  }\n  if (transitionHasExtendedAttributes(pTransition)) {\n    lReturnValue += ` [${extendedTransitionAttributes(pTransition)}]`;\n  }\n  if (pTransition.label) {\n    lReturnValue += `: ${quoteIfNecessary(LABEL_QUOTABLE, pTransition.label)}`;\n  }\n  return lReturnValue;\n}\n\nfunction transitions(\n  pTransitions: ITransition[],\n  pIndent: string = \"\",\n): string {\n  return pTransitions\n    .map((pTransition) => `${transition(pTransition, pIndent)};\\n`)\n    .join(\"\");\n}\n\nexport default function renderSmcat(\n  pStateMachine: IStateMachine,\n  _pOptions: IRenderOptions | null = {},\n  pIndent: string = \"\",\n): string {\n  return (\n    states(pStateMachine.states, pIndent) +\n    transitions(pStateMachine.transitions || [], pIndent)\n  );\n}\n"],
  "mappings": "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",
  "names": ["NAME_QUOTABLE", "ACTIONS_QUOTABLE", "LABEL_QUOTABLE", "RENDERABLE_STATE_ATTRIBUTES", "RENDERABLE_TRANSITION_ATTRIBUTES", "quoteIfNecessary", "pRegExp", "pString", "stateHasExtendedAttributes", "pState", "note", "pNote", "pIndent", "pNoteLine", "extendedAttribute", "pKey", "pValue", "extendedStateAttributes", "actions", "pActions", "pAction", "state", "lReturnValue", "renderSmcat", "states", "pStates", "transitionHasExtendedAttributes", "pTransition", "extendedTransitionAttributes", "transition", "transitions", "pTransitions", "pStateMachine", "_pOptions"]
}
